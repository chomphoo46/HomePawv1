datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  user_id  String @id @default(uuid())
  name     String @db.VarChar(100)
  email    String @unique
  googleId  String?  @unique
  password String?
  role      Role     @default(user)
  created_at DateTime @default(now())

  // Relations
  helpActions      HelpAction[]
  petRehomePosts   PetRehomePost[]
  animalReports    AnimalReports[]
  adoptionRequests AdoptionRequest[]
}

model AnimalReports {
  report_id   Int      @id @default(autoincrement())
  animal_type String   @db.VarChar(20)
  user_id     String
  description String   @db.Text
  behavior    String   @db.VarChar(100)
  latitude    Decimal  @db.Decimal(10, 6)
  longitude   Decimal  @db.Decimal(10, 6)
  location    String?
  status      AnimalReportStatus
  created_at  DateTime @default(now())

  // Relations
  images      AnimalImage[]
  actions     HelpAction[]
  user   User?          @relation(fields: [user_id], references: [user_id])
}

model AnimalImage {
  id         Int    @id @default(autoincrement())
  report_id  Int
  image_url  String @db.Text

  // Relation
  report     AnimalReports @relation(fields: [report_id], references: [report_id])
}

model HelpAction {
  id          Int      @id @default(autoincrement())
  user_id     String
  report_id   Int
  action_type HelpActionType
  created_at  DateTime @default(now())

  // Relations
  user   User          @relation(fields: [user_id], references: [user_id])
  report AnimalReports @relation(fields: [report_id], references: [report_id])
}

model PetRehomePost {
  post_id            Int                 @id @default(autoincrement())
  user_id            String
  phone              String              @db.VarChar(15)
  pet_name           String              @db.VarChar(50)
  type               String              @db.Text
  age                String              @db.VarChar(100)
  vaccination_status VaccinationStatus   
  reason             String              @db.Text
  status             PetRehomeStatus
  sex                PetSex
  address            String             @db.VarChar(255)   // เพิ่ม
  contact            String             @db.VarChar(100)   // เพิ่ม
  neutered_status    NeuteredStatus     
  created_at         DateTime            @default(now())

  // Relation
  user   User               @relation(fields: [user_id], references: [user_id])
  images PetRehomeImages[]
  adoptionRequests AdoptionRequest[]
}

model AdoptionRequest {
  id           Int      @id @default(autoincrement())
  user_id      String
  post_id      Int
  status       AdoptionRequestStatus @default(PENDING)
  name         String?  @db.VarChar(50) // ชื่อสำหรับคนช่วยเหลือ
  contact_info String?  @db.VarChar(100) // เบอร์ติดต่อ หรือ Line ID ที่กรอกตอนกดปุ่ม
  note         String?  @db.Text         // ข้อความเพิ่มเติม เช่น "บ้านมีรั้วรอบขอบชิด"
  reason       String?  @db.VarChar(255) //เหตุผลในการปฎิเสธหรืออนุมัติในการให้รับเลี้ยง
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  // Relations
  user User          @relation(fields: [user_id], references: [user_id])
  post PetRehomePost @relation(fields: [post_id], references: [post_id])
}

model PetRehomeImages {
  id         Int    @id @default(autoincrement())
  post_id    Int
  image_url  String @db.Text

  // Relation
  post PetRehomePost @relation(fields: [post_id], references: [post_id])
}

enum AdoptionRequestStatus {
  PENDING   // รอตรวจสอบ
  APPROVED  // อนุมัติแล้ว (Admin กดรับ)
  REJECTED  // ปฏิเสธ
  CANCELLED // ยกเลิกโดยผู้ใช้
}

enum AnimalReportStatus {
  STILL_THERE  // สำหรับตอนแจ้งเหตุ (ยังอยู่ที่เดิม)
  RESCUED      // สำหรับตอนแจ้งเหตุ (ช่วยเหลือแล้ว) หรือมาอัปเดต
  MOVED        // สำหรับมาอัปเดต (ย้ายที่แล้ว)
  OTHER        // อื่นๆ  
}

enum HelpActionType {
  FEED   @map("feed")
  ADOPT  @map("adopt")
}

enum VaccinationStatus {
  VACCINATED       @map("ฉีดวัดซีนแล้ว")
  NOT_VACCINATED   @map("ยังไม่ได้ฉีดวัคซีน")
}
enum NeuteredStatus{
  NEUTERED        @map("ทำหมันแล้ว")
  NOT_NEUTERED   @map("ยังไม่ได้่ทำหมัน")
}
enum PetRehomeStatus {
  AVAILABLE @map("available")
  ADOPTED   @map("adopted")
}
enum PetSex {
  MALE
  FEMALE
}
enum Role {
  user
  admin
}